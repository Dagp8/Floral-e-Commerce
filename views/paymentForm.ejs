<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment Information <%= shopName %></title>
    <link rel="stylesheet" type="text/css" href="/main.css" />
    <link rel="stylesheet" type="text/css" href="/header.css" />
    <script src="https://js.stripe.com/v3/"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var stripe = Stripe("<%= PublicKey %>");
        var elements = stripe.elements();
        var cardElement = elements.create("card");
        cardElement.mount("#card-element");

        var form = document.getElementById("payment-form");
        form.addEventListener("submit", function (event) {
          event.preventDefault();

          form.querySelector("button").disabled = true;

          // Create a card token using Stripe's card element
          stripe
            .createToken(cardElement, {
              name: document.getElementById("cardholderName").value,
              address_line1: document.getElementById("address").value,
              address_city: document.getElementById("city").value,
              number: document.getElementById("cardNumber").value,
              cvc: document.getElementById("cvc").value,
              exp_month: document.getElementById("expMonth").value,
              exp_year: document.getElementById("expYear").value,
            })
            .then(function (result) {
              if (result.error) {
                var errorElement = document.getElementById("card-errors");
                errorElement.textContent = result.error.message;
                form.querySelector("button").disabled = false;
              } else {
                var hiddenInput = document.createElement("input");
                hiddenInput.setAttribute("type", "hidden");
                hiddenInput.setAttribute("name", "stripeToken");
                hiddenInput.setAttribute("value", result.token.id);
                form.appendChild(hiddenInput);
                form.submit();
              }
            });
        });
      });
    </script>
  </head>
  <body>
    <% include('header') %>

    <div class="payment-form-container">
      <h1>Enter Payment Information</h1>

      <form id="payment-form" action="/payment" method="POST">
        <label for="cardholderName">Cardholder Name:</label>
        <input type="text" id="cardholderName" name="cardholderName" required />

        <label for="address">Address:</label>
        <input type="text" id="address" name="address" required />

        <label for="city">City:</label>
        <input type="text" id="city" name="city" required />

        <label for="cardNumber">Card Number:</label>
        <div id="card-element"></div>

        <label for="cvc">CVC:</label>
        <input type="text" id="cvc" name="cvc" required />

        <label for="expMonth">Expiration Month:</label>
        <input type="text" id="expMonth" name="expMonth" required />

        <label for="expYear">Expiration Year:</label>
        <input type="text" id="expYear" name="expYear" required />

        <div id="card-errors" role="alert"></div>

        <button type="submit">Submit Payment</button>
      </form>
    </div>

    <% include('footer') %>
  </body>
</html>
